<!DOCTYPE html>
<html>
  <head>
    <title>Slot Machine</title>
    <style>
	
	.slotHolder {
		margin: 0 auto;
		text-align: center;
		display: flex;
		justify-content: center;
		
		/*padding: 10px;*/
		
		border: 1px dashed;		
	}
	
    .slot-machine {
        display: flex;
        justify-content: center;
        align-items: flex-start;
		width: 75%;
		height: calc(100% - 1em);
		border: 0.5em solid black;
		overflow: hidden;
		
	}
	  
	  .play-button {
		width: 15%;
	  font-size: 100%;
        text-align: center;
	  
	  }
	  
      .column {
		position: relative;
        
		flex-direction: column;
		width: 18%;
		height: 134%;
		
		clip-path: inset(8% 0px 0px 0px);
		margin-top: -17%;
		padding-top: 0%;
		padding-left: 1%;
		padding-right: 1%;
		
		overflow: hidden;
      }
      .column:first-child,
      .column:last-child {
        background-color: #ddd;
      }
	  
	  .column > div:nth-child(2),
	  .column > div:nth-child(4) {
		/*filter: sepia(100%) saturate(300%) brightness(70%) hue-rotate(180deg);*/
		
		}
	  
      .symbol {
		visibility: hidden;
	        
        text-align: center;
				
		position: relative
		
		width: 0.9%;
		height: 14.9%;

		/*top:-100%;*/
		
		
		/* animation */
		/*transition: transform 3.0s cubic-bezier(.76,1.24,.95,1.04);*/
		transform: translateY(-1800%);
      }
	  img {
	  visibility: visible;
	  position: relative;
		
		max-width: 25vw;
		max-height: 25vh;
		width: 100%;
		height: 100%;
		left:0px;
		
	  }
	  
    </style>
  </head>
  <body>
	<div class="slotHolder" id="slotHolder">
		<button id="play-button">Click<br>to<br>play</button>
	</div>
	<div class="scrollable">
		<div class="symbol-count"></div>
	</div>
	</body>
  


	
	
    <script>
      // add your JavaScript code here
      const slotSymbols = ['A', 'D', 'G', 'T', 'H', 'K', 'L', 'M', '2', 'Y', 'U'];

      const getRandomSymbol = () => {
        return slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
      }

	let symbols = [];
	let symbolsList = [];
	let symbolsTopBottom = [];//holder for top and bottom row symbols
	const slotHolder = document.querySelector('.slotHolder');

	window.addEventListener("resize", resizeit);
	
	function resizeit(){     // the element
		//If Width is smaller (cellphone) then use the full 100% width and base height on that
		console.log("window.innerWidth " + window.innerWidth);
		console.log("window.innerHeight " + window.innerHeight);
		var wWidth = Math.floor(window.innerWidth);
		var wHeight = Math.floor(window.innerHeight);
		console.log("wWidth " + wWidth);
		console.log("wHeight " + wHeight);
		//IF the width is smaller (cellphone)
		//Then full width is controlling size
		if (wWidth <= wHeight*1.2) {
			console.log("tiny width");
			slotHolder.style.width = wWidth + 'px';
			slotHolder.style.height = wWidth * 5/6 *0.8 + 'px';
		} else {
		console.log("its widescreen");
			//If Height is smaller (pc screen) then use full 90% height and base width on that
			slotHolder.style.height = wHeight * 0.8 + 'px';
			slotHolder.style.width = wHeight * 6/5 + 'px';
		}
    };

	resizeit();

		//make the symbols that make up a column
      const createColumn = (time) => {
        const column = document.createElement('div');
        column.classList.add('column');
        for (let i = 0; i < 30+(time*2); i++) {
          const symbol = document.createElement('div');
		  symbolsList.push(symbol);
          symbol.id = getRandomSymbol();
          symbol.classList.add('symbol');
		  
		  //Slap an image on that symbol
		  const img = document.createElement('img');
			img.src = `images/${symbol.id}.png`;
			img.classList.add('slot-img');
			symbol.appendChild(img);
		  
		  //console.log(time);
		  //Make the animation of each column's symbol progressively slower
		  symbol.style.transition = `transform ${time}s cubic-bezier(.76,1.24,.95,1.04)`;
          symbol.style.transform = `translateY(-${time*400+1800}%)`; 
		  
		  column.appendChild(symbol);
        }
        return column;
      }

      const createSlotMachine = () => {
        const slotMachine = document.createElement('div');
        slotMachine.classList.add('slot-machine');
        for (let i = 0; i < 5; i++) {
          slotMachine.appendChild(createColumn(i/2+1));
        }
        return slotMachine;
      }


      slotHolder.appendChild(createSlotMachine());
      
      const playButton = document.getElementById('play-button');
	  playButton.classList.add('play-button');
	  
	  
	  //CLICK THE BUTTON
	playButton.addEventListener('click', () => {
		symbolsList.length = [];
		const slotMachine = document.querySelector('.slot-machine');
		slotMachine.innerHTML = '';
		for (let i = 0; i < 5; i++) {
			slotMachine.appendChild(createColumn(i/2+1));
		}
  
		//Animate symbols moving
		setTimeout(() => {
			symbols = document.querySelectorAll('.symbol');
			symbols.forEach(symbol => symbol.style.transform = 'none');
		}, 001);//instantly start the movement of the symbols

		//Disable re-clicking
		playButton.disabled = true;
		setTimeout(() => {
			playButton.disabled = false;
		}, 3000);//3 seconds

		
		topandBottomRowColor();
		checkThreeOfAKind();
		doTheConfetti();
});
//END BUTTON

	
	function topandBottomRowColor() {
		const columns = document.querySelectorAll('.column');
		columns.forEach(column => {
			const firstChild = column.children[1];
			const thirdChild = column.children[3];
			symbolsTopBottom.push(firstChild);
			symbolsTopBottom.push(thirdChild);
		});
		//Wait 3 seconds then change color of top and bottom rows
		setTimeout(() => {
			symbolsTopBottom.forEach(symbol => {
				symbol.style.filter = 'hue-rotate(180deg)';
			});
		}, 3000);
		
	}
	
	
	const checkThreeOfAKind = () => {
  const secondSymbols = document.querySelectorAll('.column > .symbol:nth-child(3)');
  const counts = {};
  for (const symbol of secondSymbols) {
    if (counts[symbol.innerHTML]) {
      counts[symbol.innerHTML]++;
    } else {
      counts[symbol.innerHTML] = 1;
    }
  }
  const symbolCount = document.querySelector('.symbol-count');
  let text = 'Middle Row -';
  for (const [symbol, count] of Object.entries(counts)) {
    text += ` ${symbol}: ${count}`;
  }
  symbolCount.innerHTML = text;
}

	
	function doTheConfetti() {
		//Establish Confetti Zone
		const canvas = document.createElement('canvas');
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		document.body.appendChild(canvas);
		const ctx = canvas.getContext('2d');
		const particles = [];
		const particleCount = 200;
		const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f'];
		for (let i = 0; i < particleCount; i++) {
			particles.push({
				x: Math.random() * canvas.width,
				y: Math.random() * canvas.height,
				vx: Math.random() * 10 - 5,
				vy: Math.random() * 10 - 5,
				radius: Math.random() * 5 + 2,
				color: colors[Math.floor(Math.random() * colors.length)],
			});
		}

		function draw() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			particles.forEach(particle => {
				particle.x += particle.vx;
				particle.y += particle.vy;
				if (particle.x < 0 || particle.x > canvas.width) particle.vx = -particle.vx;
				if (particle.y < 0 || particle.y > canvas.height) particle.vy = -particle.vy;
				ctx.beginPath();
				ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
				ctx.fillStyle = particle.color;
				ctx.fill();
			});
			requestAnimationFrame(draw);
		}
		draw();
		setTimeout(() => {
			clearInterval(interval);
			document.body.removeChild(canvas);
		}, 2000);
	}





      
    </script>

</html>
